<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>Reflections on GHC's release schedule — The Glasgow Haskell Compiler</title>
    <meta http-equiv="Content-Language" content="en-gb">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="../ghc.css" rel="stylesheet" type="text/css">

  </head>
  <body>
    <header id="header">
      <span id="header-txt"> GHC </span>
      <span id="header-name"> The Glasgow Haskell Compiler </span>
    </header>
    <div>
    <div class="row no-gutters">
      <div id="sidebar" class="col-sm-4">
       <div class="sticky-top">
          <div class="navbar-fixed-left">
	<div class="nav navbar-nav">
  <span class="nav-title">About GHC</span>
  <li class="nav-item"> <a class="nav-link" href="../">Home</a> </li>
  <li class="nav-item"> <a class="nav-link" href="../license.html">License</a> </li>
  <li class="nav-item"> <a class="nav-link" href="https://haskell.org/haskellwiki/GHC">Documentation</a> </li>
  <li class="nav-item"> <a class="nav-link" href="../blog.html">Blog</a> </li>
  <li class="nav-item"> <a class="nav-link" href="../download.html">Download</a> </li>
  <li class="nav-item"> <a class="nav-link" href="https://gitlab.haskell.org/ghc/ghc/wikis/report-a-bug">Report a bug</a> </li>
  <li class="nav-item"> <a class="nav-link" href="https://gitlab.haskell.org/ghc/ghc/wikis">Developers Wiki</a> </li>
  <span class="nav-title">About Haskell</span>
  <li class="nav-item"> <a class="nav-link" href="https://haskell.org">Haskell.org</a> </li>
  <li class="nav-item"> <a class="nav-link" href="https://www.haskell.org/haskellwiki/Definition">Haskell 2010 Report</a> </li>
  <li class="nav-item"> <a class="nav-link" href="https://www.haskell.org/haskellwiki/Mailing_lists">Haskell Mailing Lists</a> </li>
  <span class="nav-title">Links</span>
  <li class="nav-item"> <a class="nav-link" href="http://hackage.haskell.org/platform/">Haskell Platform</a> </li>
  <li class="nav-item"> <a class="nav-link" href="http://hackage.haskell.org/">Hackage</a> </li>

</div>
</div>

       </div>
      </div>
      <div id="content" class="col">
        <h1>Reflections on GHC's release schedule</h1>
<h4 class="text-muted">Ben Gamari - 2017-08-01T00:59:04</h4>

<p>Looking back on GHC’s past release schedule reveals a rather checkered past,</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Release</th>
<th style="text-align: left;">Date</th>
<th style="text-align: left;">Time to next major release</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">6.12.1</td>
<td style="text-align: left;">mid December 2009</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">12 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7.0.1</td>
<td style="text-align: left;">mid November 2010</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">9.5 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7.2.1</td>
<td style="text-align: left;">early August 2011</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">6 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7.4.1</td>
<td style="text-align: left;">early February 2012</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">7 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7.6.1</td>
<td style="text-align: left;">early September 2012</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">19 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7.8.1</td>
<td style="text-align: left;">early April 2014</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">13 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7.10.1</td>
<td style="text-align: left;">late March 2015</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">14 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8.0.1</td>
<td style="text-align: left;">late May 2016</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">14 months</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8.2.1</td>
<td style="text-align: left;">late July 2017</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8.4.1</td>
<td style="text-align: left;">TDB and the topic of this post</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>There are a few things to notice here:</p>
<ul>
<li>release cadence has swung rather wildly</li>
<li>the release cycle has stretched in the last several releases</li>
<li>time-between-releases generally tends to be on the order of a year</li>
</ul>
<p>While GHC is far from the only compiler with such an extended release schedule, others (namely LLVM, Go, and, on the extreme end, Rust) have shown that shorter cycles are possible. I personally think that a more stable, shorter release cycle would be better for developers and users alike,</p>
<ul>
<li>developers have a tighter feedback loop, inducing less pressure to get new features and non-critical bugfixes into minor releases</li>
<li>release managers have fewer patches to cherry-pick</li>
<li>users see new features and bugfixes more quickly</li>
</ul>
<p>With 8.2.1 at long last behind us, now is a good time to reflect on why these cycles are so long, what release schedule we would like to have, and what we can change to realize such a schedule. On the way we’ll take some time to examine the circumstances that lead to the 8.2.1 release which, while not typical, remind us that there is a certain amount of unpredictability inherent in developing large systems like GHC; a fact that must be born in mind when considering release policy.</p>
<p>Let’s dig in…</p>
<h2 id="the-release-process-today">The release process today</h2>
<p>Cutting a GHC release is a fairly lengthy process involving many parties and a significant amount of planning. The typical process for a major release looks something like this,</p>
<ol type="1">
<li><em>(a few months after the previous major release)</em> A set of release priorities are defined determining which major features we want in the coming release</li>
<li>wait until all major features are merged to the <code>master</code> branch</li>
<li>when all features are merged, cut a stable branch</li>
<li>in parallel:
<ol type="a">
<li>coordinate with core library authors to determine which library versions the new release should ship</li>
<li>prepare release documentation</li>
<li>do preliminary testing against Hackage and Stackage to identify and fix early bugs</li>
<li>backport significant fixes merged to <code>master</code></li>
</ol></li>
<li>when the tasks in (4) are sufficiently advanced, cut a source release for a release candidate</li>
<li>produce tier-1 builds and send source tarballs to binary packagers, wait a week to prepare binary builds; if anyone finds the tree is unbuildable, go back to (5)</li>
<li>upload release artifacts, announce release candidate</li>
<li>wait a few weeks for testing</li>
<li>if there are significant issues: fix them and return to (5)</li>
<li>finalize release details (e.g. release notes, last check over core library versions)</li>
<li>cut source tarball, send to binary build contributors, wait a week for builds</li>
<li>announce final release, celebrate!</li>
</ol>
<p>Typically the largest time-sinks in this process are waiting for regression fixes and coordinating with core library authors. In particular, the coordination involved in the latter isn’t difficult, but merely high latency.</p>
<p>In the case of 8.2.1, the timeline looked something like this,</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Time</th>
<th style="text-align: left;">Event</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Fall 2016</td>
<td style="text-align: left;">release priorities for 8.2 discussed</td>
</tr>
<tr class="even">
<td style="text-align: left;">Early March 2017</td>
<td style="text-align: left;">stable branch cut</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Early April 2017</td>
<td style="text-align: left;">most core library versions set</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">release candidate 1 cut</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mid May 2017</td>
<td style="text-align: left;">release candidate 2 cut</td>
</tr>
<tr class="even">
<td style="text-align: left;">Early July 2017</td>
<td style="text-align: left;">release candidate 3 cut</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Late July 2017</td>
<td style="text-align: left;">final release cut</td>
</tr>
</tbody>
</table>
<h2 id="unexpected-set-backs">Unexpected set-backs</h2>
<p>This timeline was a bit more extended than desired for a few reasons.</p>
<p>The first issues were <a href="https://gitlab.haskell.org/ghc/ghc/issues/13426">#13426</a> and <a href="https://gitlab.haskell.org/ghc/ghc/issues/13535">#13535</a>, compile-time performance regressions which came to light shortly after the branch and after the first release candidate, respectively. In <a href="https://gitlab.haskell.org/ghc/ghc/issues/13535">#13535</a> it was observed that the testsuite of the <code>vector</code> package (already <a href="https://ghc.haskell.org/trac/ghc/ticket/10800">known</a> for its propensity to reveal compiler regressions) increased by nearly a factor of five in compile-time allocations over 8.0.2.</p>
<p>While a performance regression would rarely classify as a release blocker, both the severity of the regressions combined with the fact that 8.2 was intended to be a performance-oriented release made releasing before fixes were available quite unappealing. For this reason David Feuer, Reid Barton, and I invested significant effort to try to track down the culprits. Unfortunately, the timescale on which this sort of bug is resolved span days, stretching to weeks when time is split with other responsibilities. While Reid’s valiant efforts lead to the resolution of <a href="https://gitlab.haskell.org/ghc/ghc/issues/13426">#13426</a>, we were eventually forced to set <a href="https://gitlab.haskell.org/ghc/ghc/issues/13535">#13535</a> aside as the release cycle wore on.</p>
<p>The second setback came in the form of two quite grave correctness issues (<a href="https://gitlab.haskell.org/ghc/ghc/issues/13615">#13615</a>, <a href="https://gitlab.haskell.org/ghc/ghc/issues/13916">#13916</a>) late in the cycle. GHC being a compiler, we take correctness very seriously: Users’ confidence that GHC will compile their programs faithfully is crucial for language adoption, yet also very easily shaken. Consequently, while neither of these issues were regressions from 8.0, we deemed it important to hold the 8.2 release until these issues were resolved (which ended up being significant efforts in their own right; a blog post on this will be coming soon).</p>
<p>Finally, there was the realization (<a href="https://gitlab.haskell.org/ghc/ghc/issues/13739">#13739</a>) after release candidate 2 that some BFD linker releases suffered from very poor performance when linking with split-sections enabled (the default behavior in 8.2.1). This served as a forcing function to act on <a href="https://gitlab.haskell.org/ghc/ghc/issues/13541">#13541</a>, which we originally planned for 8.4. As expected, it took quite some time to follow through on this in a way that satisfied users and distribution packagers in a portable manner.</p>
<h2 id="moving-forward-compressing-the-release-schedule">Moving forward: Compressing the release schedule</h2>
<p>Collectively the above issues set the release back by perhaps six or eight weeks in total, including the additional release candidate necessary to validate the raft of resulting patches. While set-backs due to long-standing bugs are hard to avoid, there are a few areas where we can do better,</p>
<ol type="a">
<li>automate the production of release artifacts</li>
<li>regularly test GHC against user packages in between releases</li>
<li>expand continuous integration of GHC to less common platforms to ensure that compatibility problems are caught before the release candidate stage</li>
<li>regularly synchronize with core library maintainers between releases to reduce need for version bound bumps at release time</li>
<li>putting in place tools to ease bisection, which is frequently a useful debugging strategy around release-time</li>
</ol>
<p>As it turns out, nearly all of these are helped by our on-going effort to move GHC’s CI infrastructure to Jenkins (see <a href="https://gitlab.haskell.org/ghc/ghc/issues/13716">#13716</a>). As this is a rather deep topic in its own right, I’ll leave this more technical discussion for a second post (blog:jenkins-ci).</p>
<p>With the above tooling and process improvements, I think it would be feasible to get the GHC release cycle down to six months or shorter if we so desired. Of course, shorter isn’t necessarily better: we need to be careful to balance the desire for a short release cycle against the need for an adequate post-release “percolation” time. This time is crucial to allow the community to adopt the new release, discover and fix its regressions. In fact, the predictability that a short release schedule (hopefully) affords is arguably more important than the high cadence itself.</p>
<p>Consequently, we are considering tightening up the release schedule for future GHC releases in a slow and measured manner. Given that we are now well into the summer, I think positioning the 8.4 release around February 2018, around seven months from now, would be a sensible timeline. However, we would like to hear your opinions.</p>
<p>Here are some things to think about,</p>
<ol type="1">
<li>Do you feel that it takes too long for GHC features to make it to users’ hands?</li>
<li>How many times per year do you envision upgrading your compiler before the process becomes too onerous? Would the current load of interface changes per release be acceptable under a faster release cadence?</li>
<li>Should we adjust the <a href="https://prime.haskell.org/wiki/Libraries/3-Release-Policy">three-release policy</a> to counteract a shorter GHC release cycle?</li>
<li>Would you feel more likely to contribute to GHC if your work were more quickly available in a release?</li>
</ol>
<p>We would love to hear your thoughts. Be sure to mention whether you are a user, GHC contributor, or both.</p>

      </div>
    </div>
    <div class="row">
          </td>
  </tr>
</table>

    </div>
  </div>
  </body>
</html>
